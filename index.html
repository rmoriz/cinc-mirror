<!DOCTYPE html>
<html>
<head>
    <title>CINC Mirror API</title>
    <script>
        // Handle metadata requests by redirecting to static files
        function handleMetadataRequest() {
            const urlParams = new URLSearchParams(window.location.search);

            const channel = urlParams.get('c') || 'stable';
            const project = urlParams.get('p') || 'cinc';
            const version = urlParams.get('v');
            const platform = urlParams.get('p');
            const platformVersion = urlParams.get('pv');
            const machine = urlParams.get('m');

            if (!version || !platform || !platformVersion || !machine) {
                document.body.innerHTML = '<pre>Error: Missing required parameters (v, p, pv, m)</pre>';
                return;
            }

            // Construct path to static metadata file
            const metadataPath = `${channel}/${project}/${platform}-${platformVersion}-${machine}/${version}.txt`;

            // Try to fetch the metadata file
            fetch(metadataPath)
                .then(response => {
                    if (response.ok) {
                        return response.text();
                    } else {
                        throw new Error(`Metadata not found: ${metadataPath}`);
                    }
                })
                .then(data => {
                    // Set content type to text/plain and output the metadata
                    document.body.innerHTML = `<pre>${data}</pre>`;
                })
                .catch(error => {
                    document.body.innerHTML = `<pre>Error: ${error.message}</pre>`;
                });
        }

        // Check if this is a metadata request
        if (window.location.pathname.includes('/metadata')) {
            handleMetadataRequest();
        }
    </script>
</head>
<body>
    <h1>CINC Mirror Service</h1>
    <p>This is a static mirror of the CINC omnitruck service.</p>
    <p>Use URLs like: <code>/metadata?v=18&p=ubuntu&pv=20.04&m=x86_64</code></p>
</body>
</html>